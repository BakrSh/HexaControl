@model IEnumerable<HexaControl.Models.Banar>

@{
    ViewData["Title"] = "Index";
}

<div class="container">
    <form method="post" dir="rtl">

        <table class="table">
            <thead>
                <div class="form-group">
                    <button type="button" class="btn btn-success" id="save-button">Save changes</button>
                </div>
                <tr>
                    <th>
                      العنوان 
                    </th>
                    <th width="300px">
                        الفقرة
                    </th>
                    <th>
                       الرابط
                    </th>
                    

                    <th></th>
                </tr>
            </thead>
            <tbody id="itemsTableBody">
                @foreach (var item in Model)
                {
                   

                    <tr class="Hero-row">
                        <input type="hidden" readonly class="Banar-Id" value="@item.Id" />
                        <td>
                            <input value="@item.Title" class="Banar-Title" />
                        </td>
                        <td width="300px">

                            <textarea value="@item.Prgraph" style="width:250px;height:300px" class="Banar-Prgraph">
                                @item.Prgraph        
                         </textarea>
                           
                        </td>
                        <td>
                            <input value="@item.Url" class="Banar-Url" />
                        </td>
                        


                    </tr>



                }
            </tbody>
        </table>
    </form>
</div>




@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script>
    const saveButton = document.querySelector('#save-button');
    saveButton.addEventListener('click', () => {

        var Heroes = Array.from(document.querySelectorAll('.Hero-row')).map(row => ({
            Id: row.querySelector('.Banar-Id').value?.length > 0 ? parseInt(row.querySelector('.Banar-Id').value) : 0 ,
            Title: row.querySelector('.Banar-Title').value,
            Prgraph: row.querySelector('.Banar-Prgraph').value,
            Url: row.querySelector('.Banar-Url').value,
            
    }));
        SaveBanars(Heroes);
    });

    var url = '@Url.Content("~/Admin/Banars/SaveBanars")';

        function SaveBanars(Heroes) {


    fetch(url, {
    method: 'POST',

    headers: {
    'Content-Type': 'application/json'
    },
        body: JSON.stringify(Heroes)
    })

    .then(response => response.json())
    .then(result => {
        alert(result.message);
        window.location.reload();
    })
    .catch(error => {
    console.error(error);
        alert('An error occurred while saving the Heroes.');
    });
    }
    </script>

}
