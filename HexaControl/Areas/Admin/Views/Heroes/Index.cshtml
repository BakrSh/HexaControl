@model IEnumerable<HexaControl.Models.Hero>

@{
    ViewData["Title"] = "Index";
}

<div class="container">
    <form method="post" dir="rtl">
       
        <table class="table ">
            <div class="form-group">
                <button type="button" class="btn btn-success" id="save-button">Save changes</button>
            </div>
            <thead>
                <tr>
                    <th>
                        النص الرئيسي
                    </th>
                    <th>
                        النص الفرعي
                    </th>
                    <th>
                        اللينك
                    </th>
                    <th>
                        رابط الزر الرئيسي
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="itemsTableBody">


                @foreach (var item in Model)
                {

                    <tr class="Hero-row">
                        <input type="hidden" readonly class="Hero-Id" value="@item.Id" />
                        <td>
                            <input value="@item.MainText" class="Hero-MainText" />
                        </td>
                        <td>
                            <input value="@item.SubText" class="Hero-SubText" />
                        </td>
                        <td>
                            <input value="@item.SubUrl" class="Hero-SubUrl" />
                        </td>
                        <td>
                            <input value="@item.BtnUrl" class="Hero-BtnUrl" />
                        </td>


                    </tr>
                }
            </tbody>




        </table>


    </form>

</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script>
    const saveButton = document.querySelector('#save-button');
    saveButton.addEventListener('click', () => {

        var Heroes = Array.from(document.querySelectorAll('.Hero-row')).map(row => ({
            Id: row.querySelector('.Hero-Id').value?.length > 0 ? parseInt(row.querySelector('.Hero-Id').value) : 0 ,
            MainText: row.querySelector('.Hero-MainText').value,
            SubText: row.querySelector('.Hero-SubText').value,
            SubUrl: row.querySelector('.Hero-SubUrl').value,
            BtnUrl: row.querySelector('.Hero-BtnUrl').value
    }));
        saveHeroes(Heroes);
    });

    var url = '@Url.Content("~/Admin/Heroes/SaveHeroes")';

        function saveHeroes(Heroes) {


    fetch(url, {
    method: 'POST',

    headers: {
    'Content-Type': 'application/json'
    },
        body: JSON.stringify(Heroes)
    })

    .then(response => response.json())
    .then(result => {
        alert(result.message);
        window.location.reload();
    })
    .catch(error => {
    console.error(error);
        alert('An error occurred while saving the Heroes.');
    });
    }
    </script>

}
